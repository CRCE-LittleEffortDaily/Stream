<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>Stream Timer (URL Control)</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

<style>
    body {
        margin: 0;
        padding: 0;
        background: transparent;
        font-family: 'Inter', sans-serif;
        color: #000;
        user-select: none;
    }

    #time-display {
        font-size: 48px;
        font-weight: 600;
        letter-spacing: 2px;
        text-align: center;
        padding: 10px;
    }
</style>
</head>

<body>
<div id="time-display">--</div>

<script>
// =========================
// URL 參數
// =========================
const url = new URLSearchParams(window.location.search);

const timerColor = url.get("color") ? url.get("color") : "#000000";

// 顯示單位控制
const showDays  = url.get("days")  !== "0";
const showHours = url.get("hours") !== "0";
const showMins  = url.get("mins")  !== "0";
const showSecs  = url.get("secs")  !== "0";

// pause 控制
const pauseParam = url.get("pause"); // "1" or "0"

// t 控制
function parseTimeString(str) {
    if (!str) return null;
    let total = 0;
    let regex = /(\d+)(d|h|m|s)/g;
    let match;
    while ((match = regex.exec(str)) !== null) {
        let v = parseInt(match[1]);
        let u = match[2];
        if (u === "d") total += v * 86400;
        if (u === "h") total += v * 3600;
        if (u === "m") total += v * 60;
        if (u === "s") total += v;
    }
    return total > 0 ? total : null;
}

let remaining = parseTimeString(url.get("t")) || 0;
let paused = pauseParam === "1";
let timer = null;


// =========================
// 顯示更新
// =========================
function updateDisplay() {
    let total = remaining;

    let days = Math.floor(total / 86400);
    total %= 86400;

    let hours = Math.floor(total / 3600);
    total %= 3600;

    let mins = Math.floor(total / 60);
    let secs = total % 60;

    const parts = [];
    if (showDays)  parts.push(days.toString().padStart(2, "0") + "d");
    if (showHours) parts.push(hours.toString().padStart(2, "0") + "h");
    if (showMins)  parts.push(mins.toString().padStart(2, "0") + "m");
    if (showSecs)  parts.push(secs.toString().padStart(2, "0") + "s");

    const display = document.getElementById("time-display");
    display.style.color = timerColor;
    display.innerText = parts.length ? parts.join(" : ") : "--";
}


// =========================
// 計時器
// =========================
function startTimer() {
    if (timer) clearInterval(timer);
    paused = false;

    timer = setInterval(() => {
        if (!paused && remaining > 0) {
            remaining--;
            updateDisplay();
        }
        if (remaining <= 0) {
            clearInterval(timer);
            timer = null;
        }
    }, 1000);
}

function pauseTimer() {
    paused = true;
    clearInterval(timer);
    timer = null;
}


// =========================
// 初始化流程
// =========================
updateDisplay();

if (remaining > 0 && !paused) startTimer();
if (paused) pauseTimer();

</script>
</body>
</html>
